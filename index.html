---
layout: null
title: Discover Geo-tagged Videos - YouTube Geofind
---

<!doctype html>
<html lang="en">
	<head>
		<title>Discover Geo-tagged Videos - YouTube Geofind</title>
		{% include_relative head.html %}
		<script>
			var map = null;
			var map_init = false;
			var markers = [];
		</script>
	</head>

	<body>
		{% include_relative nav.html %}
		<div id="map"></div>
		<main role="main" class="container">
			<br>
			<form>
				<div class="form-group">
					<label for="channelInput">Channel ID or Username</label>
					<input type="text" class="form-control" id="channelInput" aria-describedby="help" 
						placeholder="e.g. UCUcyEsEjhPEDf69RRVhRh4A or TheGreatWar"
						value="oceanexplorergov"></input>
					<small id="help" class="form-text text-muted">Enter the channel id or channel name to check their videos for geo-tags.</small>
				</div>
				<div class="form-group" align=right>
					<button type="button"  class="btn btn-primary" id="btnFind" onclick="submitTest()">Check Videos</button>
					<button type="button" class="btn btn-link" id="btnSave" disabled>Save to CSV</button>
				</div>
			</form>
			<h4>Geotag Entries</h4>
			<div class="progress">
				<div id="videoProg" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div id="geotags" align=left></div>
			<script>
				function initMap() {
					let centerPos = {lat: 40.697, lng: -74.259};
					map = new google.maps.Map(document.getElementById('map'), {
						zoom: 7,
						center: centerPos
					});
					map_init = true;
				}
				function submitTest() {
					$('#btnFind').attr("disabled",true);
					$('#videoProg').css("width", "100%").attr("aria-valuenow", "100").addClass("progress-bar-animated");
					let input = document.getElementById('channelInput').value;
					let payload = null
					if(input.length <= 20) { // Unsure of actual limits but max of 20 chars found online.
						console.log('Attempting forUsername');
						payload = {forUsername: input};
					} else if(input.length == 24) {
						console.log('Attempting by channel id');
						payload = {id: input};
					}
					if(payload != null){
						// Get channel data.
						$.ajax({
							cache: false,
							data: $.extend({
								key: GOOGLE_API_KEY,
								part: 'snippet,contentDetails',
							},payload),
							dataType: 'json',
							type: 'GET',
							timeout: 5000,
							url: 'https://www.googleapis.com/youtube/v3/channels'
						}).done(function(res) {
							var thumbUrl = res.items[0].snippet.thumbnails.default.url;
							let uploadPlaylistId = res.items[0].contentDetails.relatedPlaylists.uploads;
							progCurrent = 0;
							checkPlaylistItems(uploadPlaylistId, '', thumbUrl);
						});
					}
				}
				function checkPlaylistItems(playlistId, pageToken, thumbUrl) {
					console.log("Playlist["+playlistId+"]["+pageToken+"]: "+thumbUrl);
					$.ajax({
						cache: false,
						data: {
							key: GOOGLE_API_KEY,
							part: 'snippet',
							maxResults: 50,
							playlistId: playlistId,
							pageToken: pageToken
						},
						dataType: 'json',
						type: 'GET',
						timeout: 5000,
						url: 'https://www.googleapis.com/youtube/v3/playlistItems'
					}).done(function(res) {
						if(pageToken == '') {
							progTotal = res.pageInfo.totalResults;
						}
						let ids = [];
						for(let i=0; i<res.items.length; i++) {
							ids.push(res.items[i].snippet.resourceId.videoId);
						}
						progCurrent += res.items.length;
						checkVideoIds(ids, thumbUrl);
						$('#videoProg').text(progCurrent+" / "+progTotal);
						if(res.hasOwnProperty('nextPageToken')) {
							checkPlaylistItems(playlistId, res.nextPageToken, thumbUrl);
						} else {
							$('#videoProg').css("width", "100%").attr("aria-valuenow", "100").removeClass("progress-bar-animated");
							$('#btnFind').attr("disabled",false);
						}
					});
				}
				// videoIds an array of max 50 entries, places in map if location exists
				function checkVideoIds(videoIds, thumbUrl) {
					console.log("VideoIds: "+thumbUrl);
					$.ajax({
						cache: false,
						data: {
							key: GOOGLE_API_KEY,
							part: 'snippet,recordingDetails',
							maxResults: 50,
							id: videoIds.join(',')
						},
						dataType: 'json',
						type: 'GET',
						timeout: 5000,
						url: 'https://www.googleapis.com/youtube/v3/videos'
					}).done(function(res) {
						for(let i=0; i<res.items.length; i++) {
							let item = res.items[i];
							if(item.hasOwnProperty('recordingDetails')) {
								if(item.recordingDetails.hasOwnProperty('location')) {
									let location = item.recordingDetails.location;
									if(location.hasOwnProperty('latitude') && location.hasOwnProperty('longitude')) {
										let latitude = location.latitude;
										let longitude = location.longitude;
										let infowindow = new google.maps.InfoWindow({
											content: '<div id="geotag"><a target="_blank" href="https://youtu.be/'+item.id+'">'+item.snippet.title+'</a><br>Latitude: '+latitude+'<br>Longitude: '+longitude+'</div>'
										});
										let icon = {
											url: thumbUrl,
											scaledSize: new google.maps.Size(20, 20),
											origin: new google.maps.Point(0,0),
											anchor: new google.maps.Point(0,0)
										}
										let marker = new google.maps.Marker({
											position:{lat: latitude, lng: longitude}, 
											map: map,
											icon: icon
										});
										marker.addListener('click', function() {
											infowindow.open(map, marker);
										});
										markers.push(marker);
										refitMapToMarkers();
										let html = '<div id="geotag"><img id="geotag-thumb" src="'+thumbUrl+'" width=25px height=25px/><a href="https://youtu.be/'+item.id+'">'+item.snippet.title+'</a></div>';
										$('#geotags').append(html);
									}
								}
							}
						}
					});
				}
				function refitMapToMarkers() {
					let bounds = new google.maps.LatLngBounds();
					for(let i=0; i<markers.length; i++) {
						bounds.extend(markers[i].getPosition());
					}
					map.fitBounds(bounds);
				}
			</script>
		</main><!-- /.container -->
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGWanOEMEgdHqsxNDaa_ZXTZ6hoYQrnAI&callback=initMap"></script>
	</body>
</html>